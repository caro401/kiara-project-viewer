---
import Layout from "@layouts/Layout.astro";
import Pipeline from "@components/Pipeline.svelte";
import apiClient from "@lib/kiara_api";

export async function getStaticPaths() {
  let pipeline_ids = await apiClient.list_pipeline_ids();
  // TODO remove this filter when the extra pipelines work in kiara.service
  pipeline_ids = pipeline_ids.filter(
    (p) => !["topic_modeling", "victors_super_nice_test_workflow"].includes(p)
  );
  return pipeline_ids.map((p) => {
    return { params: { pipeline: p } };
  });
}

const { pipeline } = Astro.params;
const data = await apiClient.get_pipeline_structure(pipeline);
---

<Layout title={pipeline}>
  <main
    class="prose prose-slate dark:prose-invert max-w-screen-lg w-full mx-auto px-4"
  >
    <a class="m-4" href="/public">&larr;back to pipelines list</a>
    <Pipeline pipeline={data} client:load />
  </main>
</Layout>
